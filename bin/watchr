#!/usr/bin/env ruby

require 'pathname'
require 'optparse'
root  = Pathname(__FILE__).dirname.parent
require root.join('lib/watchr')
require root.join('lib/watchr/version')

def usage
  "Usage: watchr [opts] path/to/script"
end

def version
  "watchr version: %s" % Watchr.version
end

opts = OptionParser.new do |opts|
  opts.banner = usage

  opts.on('-d', '--debug', "Print extra debug info while program runs") {
    Watchr.options.debug = true
  }

  opts.on_tail('-h', '--help', "Print inline help") { puts opts;    exit }
  opts.on_tail('-v', '--version', "Print version" ) { puts version; exit }

  opts.parse! ARGV
end

abort(usage) unless ARGV.first

file = Pathname(ARGV.first)
abort(%|no script found; file "#{file.to_s}" doesn't exist.|) unless file.exist?

Watchr::Controller.new(Watchr::Script.new(file), Watchr.event_handler.new).run

